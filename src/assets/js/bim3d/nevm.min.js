var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r]};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();var Nevm;(function(t){function e(t){if(Array.isArray){return Array.isArray(t)}if(t&&typeof t.length==="number"&&t.constructor===Array){return true}return false}t.isArray=e;function r(t){if(typeof t==="string"||t instanceof String){return true}return false}t.isString=r;function n(t){return t===true||t===false}t.isBoolean=n;function i(t){if((typeof t==="number"||t instanceof Number)&&!isNaN(t)){return true}return false}t.isNumber=i;function a(t){return typeof t==="function"}t.isFunction=a;function s(t){return typeof t==="undefined"}t.isUndefined=s;function o(t){return s(t)||t===null}t.isUndefinedOrNull=o;function u(t){return typeof t==="object"&&t!==null&&!Array.isArray(t)&&!(t instanceof RegExp)&&!(t instanceof Date)}t.isObject=u;var h=Object.prototype.hasOwnProperty;function f(t){if(!u(t)){return false}for(var e in t){if(h.call(t,e)){return false}}return true}t.isEmptyObject=f})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(t){if(t[0]===31&&t[1]===139)return pako.ungzip(t);else return t}t.unzip=e;var r=typeof navigator!=="undefined";var n=r&&!!navigator.userAgent.match(/Trident\/7\./);var i=r&&!!navigator.userAgent.match(/Edge/);var a=r?navigator.userAgent.toLowerCase():"";var s=typeof self!=="undefined"&&typeof window==="undefined";function o(t){return a.indexOf(t)!==-1}function u(){return typeof window!=="undefined"&&"ontouchstart"in window}t.isTouchDevice=u;function h(){if(!r)return false;return/ip(ad|hone|od)/.test(a)}t.isIOS=h;function f(){if(!r)return false;return o("android")}t.isAndroid=f;function c(){if(!r)return false;return o("safari")&&!o("chrome")}t.isSafari=c;function p(){if(!r)return false;return o("firefox")}t.isFireFox=p;function l(){if(!r)return false;return f()||h()}t.isMobile=l;function y(){if(!r)return false;return o("mac os")}t.isMac=y;function v(){if(!r)return false;return o("win32")||o("windows")}t.isWindows=v;function d(){return s}t.isInWorker=d;function m(){return n||i}t.isIE=m;function x(){}t.noop=x;var g=Object.create;var b=Object.prototype.hasOwnProperty;function w(t){var e=g(null);e["__"]=undefined;delete e["__"];for(var r in t)if(b.call(t,r)){e[r]=t[r]}return e}t.createDictionary=w})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";var e=function(){function e(){this.log=t.noop;this.info=t.noop;this.warn=t.noop;this.debug=t.noop;this.error=t.noop}Object.defineProperty(e.prototype,"level",{set:function(e){this.debug=e>=1?console.debug.bind(console):t.noop;this.log=e>=2?console.log.bind(console):t.noop;this.info=e>=3?console.info.bind(console):t.noop;this.warn=e>=4?console.warn.bind(console):t.noop;this.error=e>=5?console.error.bind(console):t.noop},enumerable:true,configurable:true});return e}();t.logger=new e})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(t,e,r){return new h(t,e,r)}t.createVector3=e;function r(t){return t instanceof h}t.isVector3Class=r;var n;function i(){if(n!==undefined)return;n=t.createMatrix4()}var a;var s;function o(){if(a!==undefined)return;a=new h}function u(){if(s!==undefined)return;s=new h}var h=function(){function t(t,e,r){this.x=t||0;this.y=e||0;this.z=r||0}t.prototype.set=function(t,e,r){this.x=t;this.y=e;this.z=r;return this};t.prototype.setScalar=function(t){this.x=t;this.y=t;this.z=t;return this};t.prototype.setX=function(t){this.x=t;return this};t.prototype.setY=function(t){this.y=t;return this};t.prototype.setZ=function(t){this.z=t;return this};t.prototype.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index of out of range: "+t)}return this};t.prototype.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index of out of range: "+t)}};t.prototype.clone=function(){return new t(this.x,this.y,this.z)};t.prototype.copy=function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this};t.prototype.add=function(t){this.x+=t.x;this.y+=t.y;this.z+=t.z;return this};t.prototype.addScalar=function(t){this.x+=t;this.y+=t;this.z+=t;return this};t.prototype.addVectors=function(t,e){this.x=t.x+e.x;this.y=t.y+e.y;this.z=t.z+e.z;return this};t.prototype.addScaledVector=function(t,e){this.x+=t.x*e;this.y+=t.y*e;this.z+=t.z*e;return this};t.prototype.sub=function(t){this.x-=t.x;this.y-=t.y;this.z-=t.z;return this};t.prototype.subScalar=function(t){this.x-=t;this.y-=t;this.z-=t;return this};t.prototype.subVectors=function(t,e){this.x=t.x-e.x;this.y=t.y-e.y;this.z=t.z-e.z;return this};t.prototype.multiply=function(t){this.x*=t.x;this.y*=t.y;this.z*=t.z;return this};t.prototype.multiplyScalar=function(t){if(isFinite(t)){this.x*=t;this.y*=t;this.z*=t}else{this.x=0;this.y=0;this.z=0}return this};t.prototype.multiplyVectors=function(t,e){this.x=t.x*e.x;this.y=t.y*e.y;this.z=t.z*e.z;return this};t.prototype.applyMatrix3=function(t){var e=this.x,r=this.y,n=this.z;var i=t.elements;this.x=i[0]*e+i[3]*r+i[6]*n;this.y=i[1]*e+i[4]*r+i[7]*n;this.z=i[2]*e+i[5]*r+i[8]*n;return this};t.prototype.applyMatrix4=function(t){var e=this.x,r=this.y,n=this.z;var i=t.elements;this.x=i[0]*e+i[4]*r+i[8]*n+i[12];this.y=i[1]*e+i[5]*r+i[9]*n+i[13];this.z=i[2]*e+i[6]*r+i[10]*n+i[14];return this};t.prototype.applyProjection=function(t){var e=this.x,r=this.y,n=this.z;var i=t.elements;var a=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*a;this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*a;this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*a;return this};t.prototype.applyQuaternion=function(t){var e=this.x,r=this.y,n=this.z;var i=t.x,a=t.y,s=t.z,o=t.w;var u=o*e+a*n-s*r;var h=o*r+s*e-i*n;var f=o*n+i*r-a*e;var c=-i*e-a*r-s*n;this.x=u*o+c*-i+h*-s-f*-a;this.y=h*o+c*-a+f*-i-u*-s;this.z=f*o+c*-s+u*-a-h*-i;return this};t.prototype.project=function(t){i();n.multiplyMatrices(t.projectionMatrix,n.getInverse(t.matrixWorld));return this.applyProjection(n)};t.prototype.unproject=function(t){i();n.multiplyMatrices(t.matrixWorld,n.getInverse(t.projectionMatrix));return this.applyProjection(n)};t.prototype.transformDirection=function(t){var e=this.x,r=this.y,n=this.z;var i=t.elements;this.x=i[0]*e+i[4]*r+i[8]*n;this.y=i[1]*e+i[5]*r+i[9]*n;this.z=i[2]*e+i[6]*r+i[10]*n;return this.normalize()};t.prototype.divide=function(t){this.x/=t.x;this.y/=t.y;this.z/=t.z;return this};t.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)};t.prototype.min=function(t){this.x=Math.min(this.x,t.x);this.y=Math.min(this.y,t.y);this.z=Math.min(this.z,t.z);return this};t.prototype.max=function(t){this.x=Math.max(this.x,t.x);this.y=Math.max(this.y,t.y);this.z=Math.max(this.z,t.z);return this};t.prototype.clamp=function(t,e){this.x=Math.max(t.x,Math.min(e.x,this.x));this.y=Math.max(t.y,Math.min(e.y,this.y));this.z=Math.max(t.z,Math.min(e.z,this.z));return this};t.prototype.clampScalar=function(t,e){o();u();a.set(t,t,t);s.set(e,e,e);return this.clamp(a,s)};t.prototype.clampLength=function(t,e){var r=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,r))/r)};t.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this};t.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this};t.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this};t.prototype.roundToZero=function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this};t.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z};t.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z};t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};t.prototype.lengthManhattan=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};t.prototype.normalize=function(){return this.divideScalar(this.length())};t.prototype.setLength=function(t){return this.multiplyScalar(t/this.length())};t.prototype.lerp=function(t,e){this.x+=(t.x-this.x)*e;this.y+=(t.y-this.y)*e;this.z+=(t.z-this.z)*e;return this};t.prototype.lerpVectors=function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)};t.prototype.cross=function(t){var e=this.x,r=this.y,n=this.z;this.x=r*t.z-n*t.y;this.y=n*t.x-e*t.z;this.z=e*t.y-r*t.x;return this};t.prototype.crossVectors=function(t,e){var r=t.x,n=t.y,i=t.z;var a=e.x,s=e.y,o=e.z;this.x=n*o-i*s;this.y=i*a-r*o;this.z=r*s-n*a;return this};t.prototype.projectOnVector=function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)};t.prototype.projectOnPlane=function(t){o();a.copy(this).projectOnVector(t);return this.sub(a)};t.prototype.reflect=function(t){o();return this.sub(a.copy(t).multiplyScalar(2*this.dot(t)))};t.prototype.angleTo=function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(Math.max(-1,Math.min(1,e)))};t.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))};t.prototype.distanceToSquared=function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n};t.prototype.distanceToManhattan=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)};t.prototype.setFromMatrixPosition=function(t){return this.setFromMatrixColumn(t,3)};t.prototype.setFromMatrixScale=function(t){var e=this.setFromMatrixColumn(t,0).length();var r=this.setFromMatrixColumn(t,1).length();var n=this.setFromMatrixColumn(t,2).length();this.x=e;this.y=r;this.z=n;return this};t.prototype.setFromMatrixColumn=function(t,e){return this.fromArray(t.elements,e*4)};t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z};t.prototype.fromArray=function(t,e){if(e===undefined)e=0;this.x=t[e];this.y=t[e+1];this.z=t[e+2];return this};t.prototype.toArray=function(t,e){if(t===undefined)t=[];if(e===undefined)e=0;t[e]=this.x;t[e+1]=this.y;t[e+2]=this.z;return t};return t}()})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(t){return new f(t)}t.createMatrix4=e;function r(t){return t instanceof f}t.isMatrix4Class=r;var n;var i;var a;var s;function o(){if(n!==undefined)return;n=t.createVector3()}function u(){if(i!==undefined)return;if(n===undefined)n=t.createVector3();i=t.createVector3();a=t.createVector3()}function h(){if(s!==undefined)return;s=new f}var f=function(){function e(t){if(t){this.elements=new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}else{this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}e.prototype.set=function(t,e,r,n,i,a,s,o,u,h,f,c,p,l,y,v){var d=this.elements;d[0]=t;d[4]=e;d[8]=r;d[12]=n;d[1]=i;d[5]=a;d[9]=s;d[13]=o;d[2]=u;d[6]=h;d[10]=f;d[14]=c;d[3]=p;d[7]=l;d[11]=y;d[15]=v;return this};e.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};e.prototype.clone=function(){return(new e).fromArray(this.elements)};e.prototype.copy=function(t){this.elements.set(t.elements);return this};e.prototype.copyPosition=function(t){var e=this.elements;var r=t.elements;e[12]=r[12];e[13]=r[13];e[14]=r[14];return this};e.prototype.extractBasis=function(t,e,r){t.setFromMatrixColumn(this,0);e.setFromMatrixColumn(this,1);r.setFromMatrixColumn(this,2);return this};e.prototype.makeBasis=function(t,e,r){this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1);return this};e.prototype.extractRotation=function(t){o();var e=this.elements;var r=t.elements;var i=1/n.setFromMatrixColumn(t,0).length();var a=1/n.setFromMatrixColumn(t,1).length();var s=1/n.setFromMatrixColumn(t,2).length();e[0]=r[0]*i;e[1]=r[1]*i;e[2]=r[2]*i;e[4]=r[4]*a;e[5]=r[5]*a;e[6]=r[6]*a;e[8]=r[8]*s;e[9]=r[9]*s;e[10]=r[10]*s;return this};e.prototype.makeRotationFromEuler=function(t){var e=this.elements;var r=t.x,n=t.y,i=t.z;var a=Math.cos(r),s=Math.sin(r);var o=Math.cos(n),u=Math.sin(n);var h=Math.cos(i),f=Math.sin(i);if(t.order==="XYZ"){var c=a*h,p=a*f,l=s*h,y=s*f;e[0]=o*h;e[4]=-o*f;e[8]=u;e[1]=p+l*u;e[5]=c-y*u;e[9]=-s*o;e[2]=y-c*u;e[6]=l+p*u;e[10]=a*o}else if(t.order==="YXZ"){var v=o*h,d=o*f,m=u*h,x=u*f;e[0]=v+x*s;e[4]=m*s-d;e[8]=a*u;e[1]=a*f;e[5]=a*h;e[9]=-s;e[2]=d*s-m;e[6]=x+v*s;e[10]=a*o}else if(t.order==="ZXY"){var v=o*h,d=o*f,m=u*h,x=u*f;e[0]=v-x*s;e[4]=-a*f;e[8]=m+d*s;e[1]=d+m*s;e[5]=a*h;e[9]=x-v*s;e[2]=-a*u;e[6]=s;e[10]=a*o}else if(t.order==="ZYX"){var c=a*h,p=a*f,l=s*h,y=s*f;e[0]=o*h;e[4]=l*u-p;e[8]=c*u+y;e[1]=o*f;e[5]=y*u+c;e[9]=p*u-l;e[2]=-u;e[6]=s*o;e[10]=a*o}else if(t.order==="YZX"){var g=a*o,b=a*u,w=s*o,z=s*u;e[0]=o*h;e[4]=z-g*f;e[8]=w*f+b;e[1]=f;e[5]=a*h;e[9]=-s*h;e[2]=-u*h;e[6]=b*f+w;e[10]=g-z*f}else if(t.order==="XZY"){var g=a*o,b=a*u,w=s*o,z=s*u;e[0]=o*h;e[4]=-f;e[8]=u*h;e[1]=g*f+z;e[5]=a*h;e[9]=b*f-w;e[2]=w*f-b;e[6]=s*h;e[10]=z*f+g}e[3]=0;e[7]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return this};e.prototype.makeRotationFromQuaternion=function(t){var e=this.elements;var r=t.x,n=t.y,i=t.z,a=t.w;var s=r+r,o=n+n,u=i+i;var h=r*s,f=r*o,c=r*u;var p=n*o,l=n*u,y=i*u;var v=a*s,d=a*o,m=a*u;e[0]=1-(p+y);e[4]=f-m;e[8]=c+d;e[1]=f+m;e[5]=1-(h+y);e[9]=l-v;e[2]=c-d;e[6]=l+v;e[10]=1-(h+p);e[3]=0;e[7]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return this};e.prototype.lookAt=function(t,e,r){u();var s=n;var o=i;var h=a;var f=this.elements;h.subVectors(t,e).normalize();if(h.lengthSq()===0){h.z=1}s.crossVectors(r,h).normalize();if(s.lengthSq()===0){h.z+=1e-4;s.crossVectors(r,h).normalize()}o.crossVectors(h,s);f[0]=s.x;f[4]=o.x;f[8]=h.x;f[1]=s.y;f[5]=o.y;f[9]=h.y;f[2]=s.z;f[6]=o.z;f[10]=h.z;return this};e.prototype.multiply=function(t){return this.multiplyMatrices(this,t)};e.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)};e.prototype.multiplyMatrices=function(t,e){var r=t.elements;var n=e.elements;var i=this.elements;var a=r[0],s=r[4],o=r[8],u=r[12];var h=r[1],f=r[5],c=r[9],p=r[13];var l=r[2],y=r[6],v=r[10],d=r[14];var m=r[3],x=r[7],g=r[11],b=r[15];var w=n[0],z=n[4],M=n[8],A=n[12];var T=n[1],k=n[5],F=n[9],O=n[13];var R=n[2],S=n[6],B=n[10],C=n[14];var N=n[3],_=n[7],V=n[11],I=n[15];i[0]=a*w+s*T+o*R+u*N;i[4]=a*z+s*k+o*S+u*_;i[8]=a*M+s*F+o*B+u*V;i[12]=a*A+s*O+o*C+u*I;i[1]=h*w+f*T+c*R+p*N;i[5]=h*z+f*k+c*S+p*_;i[9]=h*M+f*F+c*B+p*V;i[13]=h*A+f*O+c*C+p*I;i[2]=l*w+y*T+v*R+d*N;i[6]=l*z+y*k+v*S+d*_;i[10]=l*M+y*F+v*B+d*V;i[14]=l*A+y*O+v*C+d*I;i[3]=m*w+x*T+g*R+b*N;i[7]=m*z+x*k+g*S+b*_;i[11]=m*M+x*F+g*B+b*V;i[15]=m*A+x*O+g*C+b*I;return this};e.prototype.multiplyToArray=function(t,e,r){var n=this.elements;this.multiplyMatrices(t,e);r[0]=n[0];r[1]=n[1];r[2]=n[2];r[3]=n[3];r[4]=n[4];r[5]=n[5];r[6]=n[6];r[7]=n[7];r[8]=n[8];r[9]=n[9];r[10]=n[10];r[11]=n[11];r[12]=n[12];r[13]=n[13];r[14]=n[14];r[15]=n[15];return this};e.prototype.multiplyScalar=function(t){var e=this.elements;e[0]*=t;e[4]*=t;e[8]*=t;e[12]*=t;e[1]*=t;e[5]*=t;e[9]*=t;e[13]*=t;e[2]*=t;e[6]*=t;e[10]*=t;e[14]*=t;e[3]*=t;e[7]*=t;e[11]*=t;e[15]*=t;return this};e.prototype.applyToVector3Array=function(t,e,r){o();var i=n;if(e===undefined)e=0;if(r===undefined)r=t.length;for(var a=0,s=e;a<r;a+=3,s+=3){i.fromArray(t,s);i.applyMatrix4(this);i.toArray(t,s)}return t};e.prototype.determinant=function(){var t=this.elements;var e=t[0],r=t[4],n=t[8],i=t[12];var a=t[1],s=t[5],o=t[9],u=t[13];var h=t[2],f=t[6],c=t[10],p=t[14];var l=t[3],y=t[7],v=t[11],d=t[15];return l*(+i*o*f-n*u*f-i*s*c+r*u*c+n*s*p-r*o*p)+y*(+e*o*p-e*u*c+i*a*c-n*a*p+n*u*h-i*o*h)+v*(+e*u*f-e*s*p-i*a*f+r*a*p+i*s*h-r*u*h)+d*(-n*s*h-e*o*f+e*s*c+n*a*f-r*a*c+r*o*h)};e.prototype.transpose=function(){var t=this.elements;var e;e=t[1];t[1]=t[4];t[4]=e;e=t[2];t[2]=t[8];t[8]=e;e=t[6];t[6]=t[9];t[9]=e;e=t[3];t[3]=t[12];t[12]=e;e=t[7];t[7]=t[13];t[13]=e;e=t[11];t[11]=t[14];t[14]=e;return this};e.prototype.setPosition=function(t){var e=this.elements;e[12]=t.x;e[13]=t.y;e[14]=t.z;return this};e.prototype.getInverse=function(e,r){var n=this.elements,i=e.elements,a=i[0],s=i[1],o=i[2],u=i[3],h=i[4],f=i[5],c=i[6],p=i[7],l=i[8],y=i[9],v=i[10],d=i[11],m=i[12],x=i[13],g=i[14],b=i[15],w=y*g*p-x*v*p+x*c*d-f*g*d-y*c*b+f*v*b,z=m*v*p-l*g*p-m*c*d+h*g*d+l*c*b-h*v*b,M=l*x*p-m*y*p+m*f*d-h*x*d-l*f*b+h*y*b,A=m*y*c-l*x*c-m*f*v+h*x*v+l*f*g-h*y*g;var T=a*w+s*z+o*M+u*A;if(T===0){var k="Matrix.getInverse(): can't invert matrix, determinant is 0";if(r===true){throw new Error(k)}else{t.logger.warn(k)}return this.identity()}var F=1/T;n[0]=w*F;n[1]=(x*v*u-y*g*u-x*o*d+s*g*d+y*o*b-s*v*b)*F;n[2]=(f*g*u-x*c*u+x*o*p-s*g*p-f*o*b+s*c*b)*F;n[3]=(y*c*u-f*v*u-y*o*p+s*v*p+f*o*d-s*c*d)*F;n[4]=z*F;n[5]=(l*g*u-m*v*u+m*o*d-a*g*d-l*o*b+a*v*b)*F;n[6]=(m*c*u-h*g*u-m*o*p+a*g*p+h*o*b-a*c*b)*F;n[7]=(h*v*u-l*c*u+l*o*p-a*v*p-h*o*d+a*c*d)*F;n[8]=M*F;n[9]=(m*y*u-l*x*u-m*s*d+a*x*d+l*s*b-a*y*b)*F;n[10]=(h*x*u-m*f*u+m*s*p-a*x*p-h*s*b+a*f*b)*F;n[11]=(l*f*u-h*y*u-l*s*p+a*y*p+h*s*d-a*f*d)*F;n[12]=A*F;n[13]=(l*x*o-m*y*o+m*s*v-a*x*v-l*s*g+a*y*g)*F;n[14]=(m*f*o-h*x*o-m*s*c+a*x*c+h*s*g-a*f*g)*F;n[15]=(h*y*o-l*f*o+l*s*c-a*y*c-h*s*v+a*f*v)*F;return this};e.prototype.scale=function(t){var e=this.elements;var r=t.x,n=t.y,i=t.z;e[0]*=r;e[4]*=n;e[8]*=i;e[1]*=r;e[5]*=n;e[9]*=i;e[2]*=r;e[6]*=n;e[10]*=i;e[3]*=r;e[7]*=n;e[11]*=i;return this};e.prototype.getMaxScaleOnAxis=function(){var t=this.elements;var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];var r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6];var n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))};e.prototype.makeTranslation=function(t,e,r){this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1);return this};e.prototype.makeRotationX=function(t){var e=Math.cos(t),r=Math.sin(t);this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1);return this};e.prototype.makeRotationY=function(t){var e=Math.cos(t),r=Math.sin(t);this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1);return this};e.prototype.makeRotationZ=function(t){var e=Math.cos(t),r=Math.sin(t);this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1);return this};e.prototype.makeRotationAxis=function(t,e){var r=Math.cos(e);var n=Math.sin(e);var i=1-r;var a=t.x,s=t.y,o=t.z;var u=i*a,h=i*s;this.set(u*a+r,u*s-n*o,u*o+n*s,0,u*s+n*o,h*s+r,h*o-n*a,0,u*o-n*s,h*o+n*a,i*o*o+r,0,0,0,0,1);return this};e.prototype.makeScale=function(t,e,r){this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1);return this};e.prototype.makeShear=function(t,e,r){this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1);return this};e.prototype.compose=function(t,e,r){this.makeRotationFromQuaternion(e);this.scale(r);this.setPosition(t);return this};e.prototype.decompose=function(t,e,r){o();h();var i=n;var a=s;var u=this.elements;var f=i.set(u[0],u[1],u[2]).length();var c=i.set(u[4],u[5],u[6]).length();var p=i.set(u[8],u[9],u[10]).length();var l=this.determinant();if(l<0){f=-f}t.x=u[12];t.y=u[13];t.z=u[14];a.elements.set(this.elements);var y=1/f;var v=1/c;var d=1/p;a.elements[0]*=y;a.elements[1]*=y;a.elements[2]*=y;a.elements[4]*=v;a.elements[5]*=v;a.elements[6]*=v;a.elements[8]*=d;a.elements[9]*=d;a.elements[10]*=d;e.setFromRotationMatrix(a);r.x=f;r.y=c;r.z=p;return this};e.prototype.makeFrustum=function(t,e,r,n,i,a){var s=this.elements;var o=2*i/(e-t);var u=2*i/(n-r);var h=(e+t)/(e-t);var f=(n+r)/(n-r);var c=-(a+i)/(a-i);var p=-2*a*i/(a-i);s[0]=o;s[4]=0;s[8]=h;s[12]=0;s[1]=0;s[5]=u;s[9]=f;s[13]=0;s[2]=0;s[6]=0;s[10]=c;s[14]=p;s[3]=0;s[7]=0;s[11]=-1;s[15]=0;return this};e.prototype.makePerspective=function(t,e,r,n){var i=r*Math.tan(Math.PI/180*t*.5);var a=-i;var s=a*e;var o=i*e;return this.makeFrustum(s,o,a,i,r,n)};e.prototype.makeOrthographic=function(t,e,r,n,i,a){var s=this.elements;var o=1/(e-t);var u=1/(r-n);var h=1/(a-i);var f=(e+t)*o;var c=(r+n)*u;var p=(a+i)*h;s[0]=2*o;s[4]=0;s[8]=0;s[12]=-f;s[1]=0;s[5]=2*u;s[9]=0;s[13]=-c;s[2]=0;s[6]=0;s[10]=-2*h;s[14]=-p;s[3]=0;s[7]=0;s[11]=0;s[15]=1;return this};e.prototype.equals=function(t){var e=this.elements;var r=t.elements;for(var n=0;n<16;++n){if(e[n]!==r[n])return false}return true};e.prototype.fromArray=function(t,e){if(e===undefined)e=0;for(var r=0;r<16;++r){this.elements[r]=t[r+e]}return this};e.prototype.toArray=function(t,e){if(t===undefined)t=[];if(e===undefined)e=0;var r=this.elements;t[e]=r[0];t[e+1]=r[1];t[e+2]=r[2];t[e+3]=r[3];t[e+4]=r[4];t[e+5]=r[5];t[e+6]=r[6];t[e+7]=r[7];t[e+8]=r[8];t[e+9]=r[9];t[e+10]=r[10];t[e+11]=r[11];t[e+12]=r[12];t[e+13]=r[13];t[e+14]=r[14];t[e+15]=r[15];return t};return e}()})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(){return{center:t.createVector3(),radius:0}}function r(t,e){return new u(t,e)}t.createBox3=r;function n(t){return t instanceof u}t.isBox3Class=n;var i;var a;function s(){if(i!==undefined)return;i=t.createVector3()}function o(){if(a!==undefined)return;a=[t.createVector3(),t.createVector3(),t.createVector3(),t.createVector3(),t.createVector3(),t.createVector3(),t.createVector3(),t.createVector3()]}var u=function(){function r(e,r){this.min=e!==undefined?e:t.createVector3(+Infinity,+Infinity,+Infinity);this.max=r!==undefined?r:t.createVector3(-Infinity,-Infinity,-Infinity)}r.prototype.set=function(t,e){this.min.copy(t);this.max.copy(e);return this};r.prototype.setFromArray=function(t){var e=+Infinity;var r=+Infinity;var n=+Infinity;var i=-Infinity;var a=-Infinity;var s=-Infinity;for(var o=0,u=t.length;o<u;o+=3){var h=t[o];var f=t[o+1];var c=t[o+2];if(h<e)e=h;if(f<r)r=f;if(c<n)n=c;if(h>i)i=h;if(f>a)a=f;if(c>s)s=c}this.min.set(e,r,n);this.max.set(i,a,s)};r.prototype.setFromPoints=function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;++e){this.expandByPoint(t[e])}return this};r.prototype.setFromCenterAndSize=function(t,e){s();var r=i.copy(e).multiplyScalar(.5);this.min.copy(t).sub(r);this.max.copy(t).add(r);return this};r.prototype.clone=function(){return(new this.constructor).copy(this)};r.prototype.copy=function(t){this.min.copy(t.min);this.max.copy(t.max);return this};r.prototype.makeEmpty=function(){this.min.x=this.min.y=this.min.z=+Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this};r.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z};r.prototype.getCenter=function(e){var r=e||t.createVector3();return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)};r.prototype.getSize=function(e){var r=e||t.createVector3();return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)};r.prototype.expandByPoint=function(t){this.min.min(t);this.max.max(t);return this};r.prototype.expandByVector=function(t){this.min.sub(t);this.max.add(t);return this};r.prototype.expandByScalar=function(t){this.min.addScalar(-t);this.max.addScalar(t);return this};r.prototype.containsPoint=function(t){if(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z){return false}return true};r.prototype.containsBox=function(t){if(this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z){return true}return false};r.prototype.getParameter=function(e,r){var n=r||t.createVector3();return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))};r.prototype.intersectsBox=function(t){if(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z){return false}return true};r.prototype.intersectsSphere=function(t){s();this.clampPoint(t.center,i);return i.distanceToSquared(t.center)<=t.radius*t.radius};r.prototype.intersectsPlane=function(t){var e,r;if(t.normal.x>0){e=t.normal.x*this.min.x;r=t.normal.x*this.max.x}else{e=t.normal.x*this.max.x;r=t.normal.x*this.min.x}if(t.normal.y>0){e+=t.normal.y*this.min.y;r+=t.normal.y*this.max.y}else{e+=t.normal.y*this.max.y;r+=t.normal.y*this.min.y}if(t.normal.z>0){e+=t.normal.z*this.min.z;r+=t.normal.z*this.max.z}else{e+=t.normal.z*this.max.z;r+=t.normal.z*this.min.z}return e<=t.constant&&r>=t.constant};r.prototype.clampPoint=function(e,r){var n=r||t.createVector3();return n.copy(e).clamp(this.min,this.max)};r.prototype.distanceToPoint=function(t){s();var e=i.copy(t).clamp(this.min,this.max);return e.sub(t).length()};r.prototype.getBoundingSphere=function(t){s();var r=t||e();this.getCenter(r.center);r.radius=this.getSize(i).length()*.5;return r};r.prototype.intersect=function(t){this.min.max(t.min);this.max.min(t.max);if(this.isEmpty())this.makeEmpty();return this};r.prototype.union=function(t){this.min.min(t.min);this.max.max(t.max);return this};r.prototype.applyMatrix4=function(t){o();if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.setFromPoints(a);return this};r.prototype.translate=function(t){this.min.add(t);this.max.add(t);return this};r.prototype.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)};return r}()})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";var e=function(){function t(t){this.bytes4node=36;var e;var r;if(t instanceof ArrayBuffer){e=t.byteLength/this.bytes4node;r=t;this.length=e}else{e=t|0;r=new ArrayBuffer(this.bytes4node*e);this.length=0}this.capacity=e;this.raw=r;this.stride=this.bytes4node/4;this.sstride=this.bytes4node/2;this.Fn=new Float32Array(r);this.In=new Int32Array(r);this.Sn=new Uint16Array(r)}t.prototype.setLeftLeaf=function(t,e){this.In[t*this.stride+6]=e};t.prototype.getLeftLeaf=function(t){return this.In[t*this.stride+6]};t.prototype.setFragStart=function(t,e){this.In[t*this.stride+8]=e};t.prototype.getFragStart=function(t){return this.In[t*this.stride+8]};t.prototype.setFragCount=function(t,e){this.Sn[t*this.sstride+14]=e};t.prototype.getFragCount=function(t){return this.Sn[t*this.sstride+14]};t.prototype.setFlags=function(t,e,r,n){this.Sn[t*this.sstride+15]=n<<3|r<<2|e&3};t.prototype.getFlags=function(t){return this.Sn[t*this.sstride+15]};t.prototype.setBox=function(t,e){var r=t*this.stride;var n=this.Fn;if(e instanceof Float32Array){n[r]=e[0];n[r+1]=e[1];n[r+2]=e[2];n[r+3]=e[3];n[r+4]=e[4];n[r+5]=e[5]}else{n[r]=e.min.x;n[r+1]=e.min.y;n[r+2]=e.min.z;n[r+3]=e.max.x;n[r+4]=e.max.y;n[r+5]=e.max.z}};t.prototype.getBox=function(t,e){var r=t*this.stride;var n=this.Fn;e.min.x=n[r];e.min.y=n[r+1];e.min.z=n[r+2];e.max.x=n[r+3];e.max.y=n[r+4];e.max.z=n[r+5]};t.prototype.makeEmpty=function(t){var e=t*this.stride;var r=this.In;r[e+6]=-1;r[e+7]=0;r[e+8]=-1};t.prototype.realloc=function(t){if(this.length+t>this.capacity){var e=0|this.capacity*3/2;if(e<this.length+t)e=this.length+t;var r=new ArrayBuffer(e*this.bytes4node);var n=new Int32Array(r);n.set(this.In);this.capacity=e;this.raw=r;this.Fn=new Float32Array(r);this.In=n;this.Sn=new Uint16Array(r)}};t.prototype.nextNodes=function(t){this.realloc(t);var e=this.length;this.length+=t;for(var r=0;r<t;++r){this.makeEmpty(e+r)}return e};t.prototype.getRaw=function(){return this.raw.slice(0,this.length*this.bytes4node)};return t}();function r(t,e,r,n){t[e]=.5*(r[n]+r[n+3]);t[e+1]=.5*(r[n+1]+r[n+4]);t[e+2]=.5*(r[n+2]+r[n+5])}function n(t,e,r){if(t[0]>e[r])t[0]=e[r];if(t[3]<e[r])t[3]=e[r];if(t[1]>e[r+1])t[1]=e[r+1];if(t[4]<e[r+1])t[4]=e[r+1];if(t[2]>e[r+2])t[2]=e[r+2];if(t[5]<e[r+2])t[5]=e[r+2]}function i(t,e,r){var n=r===undefined?0:r;if(t[0]>e[n])t[0]=e[n];if(t[1]>e[n+1])t[1]=e[n+1];if(t[2]>e[n+2])t[2]=e[n+2];if(t[3]<e[n+3])t[3]=e[n+3];if(t[4]<e[n+4])t[4]=e[n+4];if(t[5]<e[n+5])t[5]=e[n+5]}function a(t,e,r,n){for(var i=0;i<3;++i){t[e+i]=r[n+3+i]-r[n+i]}}function s(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5]}function o(t){t[0]=Infinity;t[1]=Infinity;t[2]=Infinity;t[3]=-Infinity;t[4]=-Infinity;t[5]=-Infinity}function u(t,e){var r=e===undefined?0:e;var n=t[r+3]-t[r];var i=t[r+4]-t[r+1];var a=t[r+5]-t[r+2];if(n<0||i<0||a<0)return 0;return 2*(n*n+i*i+a*a)}var h=function(){function t(){this.lvb=new Float32Array(6);this.rvb=new Float32Array(6);this.lcb=new Float32Array(6);this.rcb=new Float32Array(6);this.ln=0;this.bn=-1;this.bst=-1;this.bct=-1}t.prototype.reset=function(){this.ln=0;this.bn=-1;this.bst=-1;this.bct=-1};return t}();var f=function(){function t(){this.bx=new Float32Array(6);this.cd=new Float32Array(6);this.np=0}t.prototype.reset=function(){this.np=0;o(this.bx);o(this.cd)};return t}();var c=function(){function t(){this.bl=new Float32Array(6);this.cl=new Float32Array(6);this.nl=0;this.al=0}t.prototype.reset=function(){this.nl=0;this.al=0;o(this.bl);o(this.cl)};return t}();var p=16;var l=15;var y=1e-5;var v=1e-5;var d=3;var m=6;var x=[];var g=[];{var b=void 0;for(b=0;b<p;++b){x.push(new f)}for(b=0;b<p-1;++b){g.push(new c)}}var w=new Float32Array(6);var z=new Float32Array(6);function M(t,e,r,a,s,o,u){var h=t.centroids;var f=t.indices4frags;var c=t.boxes;var p=u*(1-y)/o[a];var l=s[a];var v=t.sort4frags;for(var g=e;g<=r;++g){var b=f[g]|0;var w=p*(h[b*d+a]-l);var z=w|0;if(z<0){z=0}else if(z>=u){z=u-1}v[g]=z;x[z].np++;i(x[z].bx,c,b*m);n(x[z].cd,h,b*d)}}function A(t,e,r,n,a,o,h){if(o[n]<t.epsilon){h.bct=Infinity;return}var f=p;if(f>r-e+1)f=r-e+1;var c;for(c=0;c<f;++c){x[c].reset()}for(c=0;c<f-1;++c){g[c].reset()}h.bn=f;M(t,e,r,n,a,o,f);s(g[0].bl,x[0].bx);s(g[0].cl,x[0].cd);g[0].al=u(g[0].bl);g[0].nl=x[0].np;var l;var y;for(c=1;c<f-1;++c){l=x[c];y=g[c];s(y.bl,g[c-1].bl);i(y.bl,l.bx);y.al=u(y.bl);s(y.cl,g[c-1].cl);i(y.cl,l.bx);y.nl=g[c-1].nl+l.np}c=f-1;s(w,x[c].bx);s(z,x[c].cd);var v=u(w);var d=x[c].np;var m=c;var b=v*d+g[c-1].al*g[c-1].nl;s(h.rvb,w);s(h.rcb,x[c].cd);s(h.lvb,g[c-1].bl);s(h.lcb,g[c-1].cl);h.ln=g[c-1].nl;for(c=c-1;c>=1;--c){l=x[c];i(w,l.bx);i(z,l.cd);v=u(w);d+=l.np;var A=v*d+g[c-1].al*g[c-1].nl;if(A<=b){b=A;m=c;s(h.rvb,w);s(h.rcb,z);s(h.lvb,g[c-1].bl);s(h.lcb,g[c-1].cl);h.ln=g[c-1].nl}}h.bst=m;h.bct=b}function T(t,e,r,n,i,a,s){var o=t.indices4frags;var u;var h=t.sort4frags;var f=0;var c=e|0;var p=s.bst|0;var l;var y;for(u=e;u<=r;++u){l=o[u]|0;y=h[u];if(y<p){o[c++]=l}else{h[f++]=l}}for(u=0;u<f;++u){o[c+u]=h[u]}}function k(t,e,r,i,s,u,h,f){var c=t.indices4frags;var p=t.centroids;var l=s-i+1;if(l>t.frags4inner){l=t.frags4inner}if(l>f){l=f}e.setFragStart(r,i);e.setFragCount(r,l);i+=l;o(u);for(var y=i;y<=s;++y){n(u,p,d*c[y])}a(h,0,u,0);var v=0;if(h[1]>h[0])v=1;if(h[2]>h[v])v=2;return v}var F=new Float32Array(3);function O(t,e,r,n,i,s,o,u){a(F,0,s,0);var f=t.nodes;var c=o?t.frags4tleaf:t.frags4leaf;var p=o?t.frags4tinner:t.frags4tleaf;var y=t.maxfrags4leaf;var v=0;if(F[1]>F[0])v=1;if(F[2]>F[v])v=2;f.setBox(e,i);var d=0;var m=0;if(t.length){for(var x=r;x<=n;++x){d+=t.facets[t.indices4frags[x]];m++;if(d>y)break}}var g=n-r+1;var b=g<=c&&g<y||g===1;if(b||u>l||F[v]<t.epsilon){f.setLeftLeaf(e,-1);f.setFragStart(e,r);f.setFragCount(e,n-r+1);f.setFlags(e,0,0,o);return}if(p){v=k(t,f,e,r,n,s,F,m);r=r+f.getFragCount(e)}var w=new h;A(t,r,n,v,s,F,w);if(w.bn<0){f.setFragCount(e,f.getFragCount(e)+n-r+1);return}T(t,r,n,v,s,F,w);var z=f.nextNodes(2);var M=(w.lvb[3+v]+w.lvb[v])*.5;var O=(w.rvb[3+v]+w.rvb[v])*.5;f.setFlags(e,v,M<O?0:1,o);f.setLeftLeaf(e,z);t.rstack.push([t,z+1,r+w.ln,n,w.rvb,w.rcb,o,u+1]);t.rstack.push([t,z,r,r+w.ln-1,w.lvb,w.lcb,o,u+1])}function R(t){var e=t.bvo;var s=t.bco;var u=t.bvt;var h=t.bct;o(e);o(s);o(u);o(h);var f=t.centroids;var c=t.boxes;for(var p=0,l=t.length;p<l;++p){r(f,d*p,c,m*p);if(p>=t.transparent1st){n(h,f,d*p);i(u,c,m*p)}else{n(s,f,d*p);i(e,c,m*p)}}a(F,0,t.bvo,0);var y=Math.max(F[0],F[1],F[2]);t.epsilon=v*y}var S=function(){function r(t,e){this.boxes=t.bbox;this.facets=t.facets;this.materialIds=t.materialIdx;this.materials=e;this.length=t.length;this.frags4leaf=-1;this.frags4inner=-1;this.nodes=null
;this.buffer=new ArrayBuffer(this.length*4);this.sort4frags=new Int32Array(this.buffer);this.indices4frags=new Int32Array(this.length);this.centroids=new Float32Array(d*this.length);this.bvo=new Float32Array(6);this.bco=new Float32Array(6);this.bvt=new Float32Array(6);this.bct=new Float32Array(6);this.rstack=[]}r.prototype.sort=function(){var t=new Float32Array(this.buffer);var e=this.materialIds;var r=this.materials;var n=this.indices4frags;var i=0;var a=false;for(var s=0,o=this.length;s<o;++s){n[s]=s;var h=r&&r[e[s]]?r[e[s]].transparency:false;if(h)i++;if(a){t[s]=u(this.boxes,m*s);if(h)t[s]=-t[s]}else{t[s]=h?-1:1}}if(a){Array.prototype.sort.call(this.indices4frags,function(e,r){return t[r]-t[e]})}else{if(i&&i<this.length){var f=new Int32Array(i);var c=0;var p=0;for(var s=0,o=this.length;s<o;++s){if(t[s]>=0){n[c++]=n[s]}else{f[p++]=n[s]}}n.set(f,this.length-i)}}this.transparent1st=this.length-i};r.prototype.build=function(){var r=t.isMobile()?.5:1;this.frags4leaf=0|128*r;this.frags4inner=0|this.frags4leaf;this.frags4tleaf=this.frags4leaf;this.frags4tinner=0;this.maxfrags4leaf=0|1e5*r;if(this.nodes){this.nodes.length=0}else{var n=this.length/this.frags4leaf;var i=1;while(i<n)i*=2;this.nodes=new e(i)}this.sort();R(this);var a=this.nodes.nextNodes(2);O(this,a,0,this.transparent1st-1,this.bvo,this.bco,0,0);var s;while(this.rstack.length){s=this.rstack.pop();O(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7])}O(this,a+1,this.transparent1st,this.length-1,this.bvt,this.bct,1,0);while(this.rstack.length){s=this.rstack.pop();O(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7])}};return r}();function B(t,e){return new S(t,e)}t.createBVH=B})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(t){var e=new Uint16Array(t.length);for(var r=0,n=t.length;r<n;++r){e[r]=t.charCodeAt(r)}return e.buffer}var r=function(){function r(){}r.prototype.arrayBuffer=function(){if(this._body instanceof ArrayBuffer){return this._body}return e(this.text())};r.prototype.blob=function(){if(this._body instanceof Blob){return this._body}if(this._body instanceof ArrayBuffer){return new Blob([this._body])}throw new Error("The request body isn't either a blob or an array buffer")};r.prototype.json=function(){if(typeof this._body==="string"){return JSON.parse(this._body)}if(this._body instanceof ArrayBuffer){return JSON.parse(this.text())}return this._body};r.prototype.text=function(){if(this._body instanceof t.URLSearchParams){return this._body.toString()}if(this._body instanceof ArrayBuffer){return String.fromCharCode.apply(null,new Uint16Array(this._body))}if(this._body===null){return""}if(typeof this._body==="object"){return JSON.stringify(this._body,null,2)}return this._body.toString()};return r}();t.Body=r})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(t){if(typeof t!=="string"){t=String(t)}if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t)){throw new TypeError("Invalid character in header field name")}return t.toLowerCase()}function r(t){if(typeof t!=="string"){t=String(t)}return t}var n=Object.prototype.hasOwnProperty;var i=function(){function i(e){this._headers=t.createDictionary();if(e instanceof i){for(var r in e._headers){var a=e._headers[r];for(var s=0;s<a.length;++s){this.append(r,a[s])}}return}for(var r in e){if(n.call(e,r)){var a=Array.isArray(e[r])?e[r]:[e[r]];this.delete(r);for(var s=0;s<a.length;++s){this.append(r,a[s])}}}}i.prototype.append=function(t,e){var r=this.getAll(t);if(r===null){this.set(t,e)}else{r.push(e)}};i.prototype.delete=function(t){delete this._headers[e(t)]};i.prototype.get=function(t){var e=this.getAll(t);if(e===null){return null}return e.length>0?e[0]:null};i.prototype.getAll=function(t){return this.has(t)?this._headers[e(t)]:null};i.prototype.has=function(t){return e(t)in this._headers};i.prototype.keys=function(){var t=[];for(var e in this._headers){t.push(e)}return t};i.prototype.set=function(t,n){if(Array.isArray(n)){if(n.length){var i=[];for(var a=0;a<n.length;++a){i.push(r(n[a]))}this._headers[e(t)]=i}}else{this._headers[e(t)]=[r(n)]}};i.prototype.values=function(){var t=[];for(var e in this._headers){t.push(this._headers[e])}return t};i.prototype.toJSON=function(){var t={};for(var e in this._headers){var r=[];var n=this._headers[e];for(var i=0;i<n.length;++i){r.push(n[i])}t[e]=r}return t};i.fromResponseHeaderString=function(t){var e=new i;var r=t.split("\n");for(var n=0;n<r.length;++n){var a=r[n];var s=a.indexOf(":");if(s>0){var o=a.slice(0,s);var u=a.slice(s+1).trim();e.set(o,u)}}return e};return i}();t.Headers=i})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";var e=function(){};var r;(function(t){t[t["Get"]=0]="Get";t[t["Post"]=1]="Post";t[t["Put"]=2]="Put";t[t["Delete"]=3]="Delete";t[t["Options"]=4]="Options";t[t["Head"]=5]="Head";t[t["Patch"]=6]="Patch"})(r=t.RequestMethod||(t.RequestMethod={}));var n;(function(t){t[t["NONE"]=0]="NONE";t[t["JSON"]=1]="JSON";t[t["FORM"]=2]="FORM";t[t["FORM_DATA"]=3]="FORM_DATA";t[t["TEXT"]=4]="TEXT";t[t["BLOB"]=5]="BLOB";t[t["ARRAY_BUFFER"]=6]="ARRAY_BUFFER"})(n=t.ContentType||(t.ContentType={}));var i;(function(t){t[t["Text"]=0]="Text";t[t["Json"]=1]="Json";t[t["ArrayBuffer"]=2]="ArrayBuffer";t[t["Blob"]=3]="Blob"})(i=t.ResponseContentType||(t.ResponseContentType={}));var a=function(){function e(e){var r=e===void 0?{}:e,n=r.method,i=r.headers,a=r.body,s=r.url,u=r.search,h=r.withCredentials,f=r.responseType;this.method=n!=null?o(n):null;this.headers=i!=null?i:null;this.body=a!=null?a:null;this.url=s!=null?s:null;this.search=u!=null?typeof u==="string"?new t.URLSearchParams(u):u:null;this.withCredentials=h!=null?h:null;this.responseType=f!=null?f:null}e.prototype.merge=function(r){return new e({method:r&&r.method!=null?r.method:this.method,headers:r&&r.headers!=null?r.headers:this.headers,body:r&&r.body!=null?r.body:this.body,url:r&&r.url!=null?r.url:this.url,search:r&&r.search!=null?typeof r.search==="string"?new t.URLSearchParams(r.search):r.search.clone():this.search,withCredentials:r&&r.withCredentials!=null?r.withCredentials:this.withCredentials,responseType:r&&r.responseType!=null?r.responseType:this.responseType})};return e}();t.RequestOptions=a;var s=function(e){__extends(n,e);function n(){return e.call(this,{method:r.Get,headers:new t.Headers})||this}return n}(a);t.BaseRequestOptions=s;function o(t){if(typeof t!=="string")return t;switch(t.toUpperCase()){case"GET":return r.Get;case"POST":return r.Post;case"PUT":return r.Put;case"DELETE":return r.Delete;case"OPTIONS":return r.Options;case"HEAD":return r.Head;case"PATCH":return r.Patch}throw new Error('Invalid request method. The method "'+t+'" is not supported.')}var u=function(r){__extends(i,r);function i(e){var n=r.call(this)||this;var i=e.url;n.url=e.url;if(e.search){var a=e.search.toString();if(a.length>0){var s="?";if(n.url.indexOf("?")!=-1){s=n.url[n.url.length-1]=="&"?"":"&"}n.url=i+s+a}}n._body=e.body;n.method=o(e.method);n.headers=new t.Headers(e.headers);n.contentType=n.detectContentType();n.withCredentials=e.withCredentials;n.responseType=e.responseType;return n}i.prototype.detectContentType=function(){switch(this.headers.get("content-type")){case"application/json":return n.JSON;case"application/x-www-form-urlencoded":return n.FORM;case"multipart/form-data":return n.FORM_DATA;case"text/plain":case"text/html":return n.TEXT;case"application/octet-stream":return n.BLOB;default:return this.detectContentTypeFromBody()}};i.prototype.detectContentTypeFromBody=function(){if(this._body==null){return n.NONE}else if(this._body instanceof t.URLSearchParams){return n.FORM}else if(this._body instanceof e){return n.FORM_DATA}else if(this._body instanceof Blob){return n.BLOB}else if(this._body instanceof ArrayBuffer){return n.ARRAY_BUFFER}else if(this._body&&typeof this._body=="object"){return n.JSON}else{return n.TEXT}};i.prototype.getBody=function(){switch(this.contentType){case n.JSON:return this.json();case n.FORM:return this.text();case n.FORM_DATA:return this._body;case n.TEXT:return this.text();case n.BLOB:return this.blob();case n.ARRAY_BUFFER:return this.arrayBuffer();default:return null}};return i}(t.Body);t.Request=u})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";var e;(function(t){t[t["Basic"]=0]="Basic";t[t["Cors"]=1]="Cors";t[t["Default"]=2]="Default";t[t["Error"]=3]="Error";t[t["Opaque"]=4]="Opaque"})(e=t.ResponseType||(t.ResponseType={}));var r=function(){function t(t){var e=t===void 0?{}:t,r=e.body,n=e.status,i=e.headers,a=e.statusText,s=e.type,o=e.url;this.body=r!=null?r:null;this.status=n!=null?n:null;this.headers=i!=null?i:null;this.statusText=a!=null?a:null;this.type=s!=null?s:null;this.url=o!=null?o:null}return t}();t.ResponseOptions=r;var n=function(t){__extends(e,t);function e(e){var r=t.call(this)||this;r._body=e.body;r.status=e.status;r.ok=r.status>=200&&r.status<=299;r.statusText=e.statusText;r.headers=e.headers;r.type=e.type;r.url=e.url;return r}return e}(t.Body);t.Response=n})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(e){if(e===void 0){e=""}var r=t.createDictionary();if(e.length>0){var n=e.split("&");for(var i=0;i<n.length;++i){var a=n[i];var s=n.indexOf("=");var o=s==-1?[a,""]:[a.slice(0,s),a.slice(s+1)],u=o[0],h=o[1];var f=r[u]||[];f.push(h);r[u]=f}}return r}function r(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}var n=function(){function t(){}t.prototype.encodeKey=function(t){return r(t)};t.prototype.encodeValue=function(t){return r(t)};return t}();t.QueryEncoder=n;var i=function(){function t(t,r){if(t===void 0){t=""}if(r===void 0){r=new n}this.rawParams=t;this.queryEncoder=r;this.params=e(t)}t.prototype.clone=function(){var e=new t("",this.queryEncoder);e.appendAll(this);return e};t.prototype.has=function(t){return t in this.params};t.prototype.get=function(t){var e=this.params[t];return Array.isArray(e)?e[0]:null};t.prototype.getAll=function(t){return this.params[t]||[]};t.prototype.set=function(t,e){if(e===void 0||e===null){this.delete(t);return}var r=this.params[t]||[];r.length=0;r.push(e);this.params[t]=r};t.prototype.setAll=function(t){for(var e in t.params){var r=this.params[e]||[];r.length=0;r.push(t.params[e][0]);this.params[e]=r}};t.prototype.append=function(t,e){if(e===void 0||e===null)return;var r=this.params[t]||[];r.push(e);this.params[t]=r};t.prototype.appendAll=function(t){for(var e in t.params){var r=this.params[e]||[];var n=t.params[e];for(var i=0;i<n.length;++i){r.push(n[i])}this.params[e]=r}};t.prototype.delete=function(t){delete this.params[t]};t.prototype.replaceAll=function(t){for(var e in t.params){var r=this.params[e]||[];var n=t.params[e];r.length=0;for(var i=0;i<n.length;++i){r.push(n[i])}this.params[e]=r}};t.prototype.toString=function(){var t=[];for(var e in this.params){var r=this.params[e];for(var n=0;n<r.length;++n){t.push(this.queryEncoder.encodeKey(e)+"="+this.queryEncoder.encodeValue(r[n]))}}return t.join("&")};return t}();t.URLSearchParams=i})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";var e=/^\)\]\}',?\n/;function r(t){if("responseURL"in t){return t.responseURL}if(/^X-Request-URL:/m.test(t.getAllResponseHeaders())){return t.getResponseHeader("X-Request-URL")}return}function n(e,r){if(e.headers!=null&&e.headers.get("Content-Type")!=null){return}switch(e.contentType){case t.ContentType.NONE:break;case t.ContentType.JSON:r.setRequestHeader("content-type","application/json");break;case t.ContentType.FORM:r.setRequestHeader("content-type","application/x-www-form-urlencoded;charset=UTF-8");break;case t.ContentType.TEXT:r.setRequestHeader("content-type","text/plain");break;case t.ContentType.BLOB:var n=e.blob();if(n.type){r.setRequestHeader("content-type",n.type)}break}}function i(i){return new Promise(function(a,s){var o=new XMLHttpRequest;o.open(t.RequestMethod[i.method].toUpperCase(),i.url);if(i.withCredentials!=null){o.withCredentials=i.withCredentials}var u=function(){var n=o.status===1223?204:o.status;var u=null;if(n!==204){u=o.response==null?o.responseText:o.response;if(typeof u==="string"){u=u.replace(e,"")}}if(n===0){n=u?200:0}var h=t.Headers.fromResponseHeaderString(o.getAllResponseHeaders());var f=r(o)||i.url;var c=o.statusText||"OK";var p=new t.ResponseOptions({body:u,status:n,headers:h,statusText:c,url:f});var l=new t.Response(p);l.ok=n>=200&&n<300;if(l.ok){a(l);return}s(l)};var h=function(e){var r=new t.ResponseOptions({body:e,type:t.ResponseType.Error,status:o.status,statusText:o.statusText});s(new t.Response(r))};n(i,o);if(i.headers!=null){for(var f in i.headers._headers){o.setRequestHeader(f,i.headers._headers[f].join(","))}}if(i.responseType!=null&&o.responseType!=null){switch(i.responseType){case t.ResponseContentType.ArrayBuffer:o.responseType="arraybuffer";break;case t.ResponseContentType.Json:o.responseType="json";break;case t.ResponseContentType.Text:o.responseType="text";break;case t.ResponseContentType.Blob:o.responseType="blob";break;default:throw new Error("The selected responseType is not supported")}}o.addEventListener("load",u);o.addEventListener("error",h);o.send(i.getBody());return function(){o.removeEventListener("load",u);o.removeEventListener("error",h);o.abort()}})}function a(e,r,n,i){var a=e;if(r){return a.merge(new t.RequestOptions({method:r.method||n,url:r.url||i,search:r.search,headers:r.headers,body:r.body,withCredentials:r.withCredentials,responseType:r.responseType}))}return a.merge(new t.RequestOptions({method:n,url:i}))}var s=function(){function e(t){this._defaultOptions=t}e.prototype.request=function(e,r){if(typeof e==="string"){return i(new t.Request(a(this._defaultOptions,r,t.RequestMethod.Get,e)))}else if(e instanceof t.Request){return i(e)}else{throw new Error("url must be a string or Request Instance")}};e.prototype.get=function(e,r){return this.request(new t.Request(a(this._defaultOptions,r,t.RequestMethod.Get,e)))};e.prototype.post=function(e,r,n){return this.request(new t.Request(a(this._defaultOptions.merge(new t.RequestOptions({body:r})),n,t.RequestMethod.Post,e)))};e.prototype.put=function(e,r,n){return this.request(new t.Request(a(this._defaultOptions.merge(new t.RequestOptions({body:r})),n,t.RequestMethod.Put,e)))};e.prototype.delete=function(e,r){return this.request(new t.Request(a(this._defaultOptions,r,t.RequestMethod.Delete,e)))};e.prototype.patch=function(e,r,n){return this.request(new t.Request(a(this._defaultOptions.merge(new t.RequestOptions({body:r})),n,t.RequestMethod.Patch,e)))};e.prototype.head=function(e,r){return this.request(new t.Request(a(this._defaultOptions,r,t.RequestMethod.Head,e)))};e.prototype.options=function(e,r){return this.request(new t.Request(a(this._defaultOptions,r,t.RequestMethod.Options,e)))};return e}();t.Http=s})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(e){r(e);switch(e.action){case 1:t.load(e);break;case 2:t.upload(e);break;case 3:t.search(e);break}}t.route=e;function r(t){t.baseUrl="";if(t.url){var e=t.url.lastIndexOf("/");if(e!==-1)t.baseUrl=t.url.substr(0,e+1)}}self.raiseError=function(t,e,r){postMessage({error:{code:t,message:e,args:r}})};function n(t,e){postMessage(t,e)}t.sendMessage=n})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";var e=new ArrayBuffer(8);var r=new Uint8Array(e);var n=new Uint16Array(e);var i=new Int32Array(e);var a=new Uint32Array(e);var s=new Float32Array(e);var o=new Float64Array(e);var u=String.fromCharCode;var h=function(){function t(t){this.position=0;this.byteLength=t.byteLength;this.buffer=t}t.prototype.getPosition=function(){return this.position};t.prototype.getByteLength=function(){return this.byteLength};t.prototype.seek=function(t,e){if(e===0){this.position=t}else if(e===1){this.position+=t}else if(e===2){this.position=this.byteLength-t}};t.prototype.reset=function(t){this.position=0;this.byteLength=t.byteLength;this.buffer=t};t.prototype.readDate=function(){var t=this.buffer[this.position];var e=this.buffer[this.position+1];var r=this.buffer[this.position+2];var n=this.buffer[this.position+3];this.position+=4;return new Date((n>>1)+1980,15&(n<<3|r>>5),31&r,e>>3,63&(e<<3|t>>5),(31&t)*2)};t.prototype.readBoolean=function(){return!!this.readUint8()};t.prototype.readUint8=function(){return this.buffer[this.position++]};t.prototype.readInt16=function(){var t=this.readUint16();if(t>32767)t=t|4294901760;return t};t.prototype.readUint16=function(){r[0]=this.buffer[this.position++];r[1]=this.buffer[this.position++];return n[0]};t.prototype.readInt32=function(){r[0]=this.buffer[this.position];r[1]=this.buffer[this.position+1];r[2]=this.buffer[this.position+2];r[3]=this.buffer[this.position+3];this.position+=4;return i[0]};t.prototype.readUint32=function(){r[0]=this.buffer[this.position];r[1]=this.buffer[this.position+1];r[2]=this.buffer[this.position+2];r[3]=this.buffer[this.position+3];this.position+=4;return a[0]};t.prototype.readFloat32=function(){r[0]=this.buffer[this.position];r[1]=this.buffer[this.position+1];r[2]=this.buffer[this.position+2];r[3]=this.buffer[this.position+3];this.position+=4;return s[0]};t.prototype.readFloat64=function(){for(var t=0;t<8;t++){r[t]=this.buffer[this.position+t]}this.position+=8;return o[0]};return t}();h.prototype.readString=function(){var t="",e,r,n,i,a,s;return function(){e=0;t="";s=this.readVarint();a=this.position;while(e<s){r=this.buffer[a+e++];switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=u(r);break;case 12:case 13:n=this.buffer[a+e++];t+=u((r&31)<<6|n&63);break;case 14:n=this.buffer[a+e++];i=this.buffer[a+e++];t+=u((r&15)<<12|(n&63)<<6|(i&63)<<0);break}}this.position+=s;return t}}();h.prototype.readVarint=function(){var t;var e=0;var r=0;return function(){e=0;r=0;do{t=this.readUint8();e|=(t&127)<<r;r+=7}while(t&128);return e}}();var f=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}e.prototype.readStrideArray=function(t,e,r,n,i,a){var s=this.buffer;var o=this.position;var u=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);r*=a;i*=a;n*=4;for(var h=0;h<e;++h){for(var f=0;f<i;++f){u[r+f]=s[o++]}r+=n}this.position=o};e.prototype.readArray=function(t,e){var r=e*t.BYTES_PER_ELEMENT;var n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);n.set(this.buffer.subarray(this.position,this.position+r));this.position+=r};return e}(h);f.prototype.readVector3f=function(){var e=t.createVector3();return function(){e.x=this.readFloat32();e.y=this.readFloat32();e.z=this.readFloat32();return e.clone()}}();f.prototype.readVector3d=function(){var t={x:0,y:0,z:0};return function(){t.x=this.readFloat64();t.y=this.readFloat64();t.z=this.readFloat64();return t}}();f.prototype.readTransform4=function(){var e={x:1,y:1,z:1};var r=t.createMatrix4(true);return function(){var t;var n;var i=this.readUint8();switch(i){case 0:r.identity();break;case 1:t=this.readVector3d();r.makeTranslation(t.x,t.y,t.z);break;case 2:n=this.readQuaternionf();t=this.readVector3d();e.x=1;e.y=1;e.z=1;r.compose(t,n,e);break;case 3:var a=this.readFloat32();n=this.readQuaternionf();t=this.readVector3d();e.x=a;e.y=a;e.z=a;r.compose(t,n,e);break;case 4:this.readMatrix3f(r);t=this.readVector3d();r.setPosition(t);break;default:return null}return r}}();f.prototype.readMatrix3f=function(){var e=t.createMatrix4();return function(t){if(!t)t=e;t.identity();var r=this.readVector3f();var n=this.readVector3f();var i=this.readVector3f();t.makeBasis(r,n,i);return t}}();f.prototype.readQuaternionf=function(){var t={x:0,y:0,z:0,w:0};return function(){t.x=this.readFloat32();t.y=this.readFloat32();t.z=this.readFloat32();t.w=this.readFloat32();return t}}();f.prototype.readBox=function(){var e=t.createBox3();return function(){e.min.x=this.readFloat32();e.min.y=this.readFloat32();e.min.z=this.readFloat32();e.max.x=this.readFloat32();e.max.y=this.readFloat32();e.max.z=this.readFloat32();return e.clone()}}();f.prototype.readUniqueId=function(){var t=function(t){var e=t>>4&15,r=t&15;return u(e>9?e-10+97:e+48)+u(r>9?r-10+97:r+48)};var e="",r;return function(){e="";r=this.readInt32();e+=t(r>>24),e+=t(r>>16),e+=t(r>>8),e+=t(r);e+="-";r=this.readInt16();e+=t(r>>8),e+=t(r);e+="-";r=this.readInt16();e+=t(r>>8),e+=t(r);e+="-";r=this.readUint8();e+=t(r);r=this.readUint8();e+=t(r);e+="-";for(var n=0;n<6;n++){r=this.readUint8();e+=t(r)}return e}}();function c(t){return new f(t)}t.createStream=c})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(t){return new r(t)}t.createContext=e;var r=function(){function e(t){this.reset(t)}e.prototype.reset=function(e){if(this.stream){this.stream.reset(e)}else{this.stream=t.createStream(e)}this.objectTypes=[];this.objectOffsets=[];var r=this.stream;var n=r.readUint32();if(n!==1515259669)return null;this.version=r.readUint16();this.compress=r.readUint16();this.time=r.readDate();r.seek(8,2);var i=r.readUint32();var a=r.readUint32();r.seek(a,0);var s=r.readVarint();for(var o=0;o<s;++o){this.objectTypes.push({version:r.readVarint(),type:r.readVarint(),description:r.readString()})}r.seek(i,0);var u=r.readVarint();for(var o=0;o<u;++o){this.objectOffsets.push(r.readUint32())}r.seek(0,0);this.stream=r};e.prototype.getObject=function(t){if(t>=this.objectOffsets.length)return null;this.stream.seek(this.objectOffsets[t],0);var e=this.stream.readVarint();if(e>=this.objectTypes.length)return null;return this.objectTypes[e]};e.prototype.getObjectCount=function(){return this.objectOffsets.length};return e}()})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(e){if(e.taskType===undefined)e.taskType=e.packageType;o(e);var r=new t.BaseRequestOptions;var n=e.options||{};r=r.merge(n);var i=new t.Http(r);i.get(e.url).then(function(r){if(e.context){e.context.reset(t.unzip(new Uint8Array(r.arrayBuffer())))}else{e.context=t.createContext(t.unzip(new Uint8Array(r.arrayBuffer())))}if(e.packageType){return h(e,function(){f(e)})}throw new Error("Unknown Data")},function(t){u(t.status,t.statusText,e)}).catch(function(t){e.worker.raiseError(2,t.toString(),{url:e.url})})}t.load=e;var r=0;var n=1|8|2|4;function i(i){r|=i.packageType;if(r!==n){if(!(r&1)){i.packageType=1|2147483648}else if(!(r&4)){i.packageType=4|2147483648}else if(!(r&8)){i.packageType=8|2147483648}else if(!(r&2)){i.packageType=2|2147483648}else if(!(r&64)){i.packageType=64|2147483648}e(i)}else{var s=i.data.transferList;delete i.data.transferList;i.data.packageType=i.taskType;a(i.data,s);t.sendMessage(i.data,s);i=null;s=null}}function a(e,r){var n=e.meshes;var i=e.fragments.facets;var a=e.fragments.mesh2frag;var s=t.createDictionary();var o;var u;var h;e.fragments.loaded=0;for(var f=0;f<n.length;++f){o=a[f];u=n[f];if(t.isArray(o)){for(var c=0;c<o.length;++c){i[o[c]]=u.facetCount}}else{i[o]=u.facetCount}h=parseInt(u.package)+":"+u.idx;s[h]=f}e.geometries=s;e.boundingBox=e.world.boundingBox;e.worldMatrix=e.world.transform;e.up=e.world.up;delete e.meshes;delete e.world;var p=t.createBVH(e.fragments,e.materials);p.build();e.nodes=p.nodes;e.indices=p.indices4frags;r.push(p.nodes.getRaw());r.push(p.indices4frags.buffer)}function s(t){switch(t){case 1:return"project.jdx";case 8:return"fragment.jdx";case 4:return"texc.jdx";case 2:return"geometry.jdx";case 64:return"props.adx";default:return""}}function o(e){if(e.packageType&2147483648){if(!e.data){e.data={};e.data["transferList"]=[]}e.packageType&=2147483647;if(e.packageType===0){e.packageType=1}e.options.responseType=t.ResponseContentType.ArrayBuffer;e.url=e.baseUrl+s(e.packageType)}}function u(t,e,r){if(t==403){self.raiseError(4,"(HTTP 403)",{url:r.url,status:t,statusText:e})}else if(t==404){self.raiseError(5," (HTTP 404)",{url:r.url,status:t,statusText:e})}else if(t>=500&&t<600){self.raiseError(6," (HTTP 5xx)",{url:r.url,status:t,statusText:e})}else if(r.exception){self.raiseError(3,"",{url:r.url,exception:r.exception.toString(),stack:r.exception.stack})}else{self.raiseError(7," (HTTP 'everything else')",{url:r.url,status:t,statusText:e,data:r})}}function h(t,e){try{e()}catch(e){t.worker.raiseError(2,"",{url:t.url,exception:e.toString(),stack:e.stack})}}function f(t){switch(t.packageType){case 32:y(t);break;case 2:v(t);break;case 8:d(t);break;case 1:m(t);break;case 4:x(t);break;case 64:g(t);break}}function c(t,e,r,n){n=n?n:null;var i={objectDef:r,package:t,workerId:-1,packageType:e,vb:n,vbo:[]};return i}function p(){var t={world:{up:null,boundingBox:null,transform:null},camera:{isPerspective:false,aspect:0,fov:50,orthoScale:0,position:null,target:null,up:null},packages:[],uuids:[]};return t}function l(e,r,n){var i=e[r];if(i===undefined){e[r]=n}else{if(t.isArray(i)){i.push(n)}else{e[r]=[i];e[r].push(n)}}}function y(e){var r=e.worker;var n=e.context;var i=n.stream;return h();function a(t){var e=n.getObject(t);if(!e)return 0;var r=n.stream;if(e.type===2){var i=r.readUint32();if(i!==1510801694)return 0;var a=r.readUint32();var s=r.readUint32();var o=r.readUint32();var u=r.readUint32();var h=6+o*2+u*0;var f=a*h;var c=f+((s*3*2+3)/4|0);return c*4}else if(e.type===4){return 0}return 0}function s(t,e,r){var n=t.vertexCount;var a=t.facetCount;var s=t.strides;var o=n*s;var u=o+((a*3*2+3)/4|0);t.byteLength=u*4;t.vb=new Float32Array(e,r,o);t.indices=new Uint16Array(e,r+o*4,a*3);i.readArray(t.indices,a*3);i.readStrideArray(t.vb,n,t.attributes.position.offset,s,t.attributes.position.itemSize,4);i.readStrideArray(t.vb,n,t.attributes.normal.offset,s,t.attributes.normal.itemSize,4);i.readStrideArray(t.vb,n,t.attributes.uv.offset,s,t.attributes.uv.itemSize,4)}function o(t,e){var r=i.readUint32();if(r!==1510801694)return null;var n={};n.vertexCount=i.readUint32();n.facetCount=i.readUint32();n.uvMapCount=i.readUint32();n.attrsCount=i.readUint32();n.strides=8;n.attributes={};n.attributes.position={offset:0,itemSize:3};n.attributes.normal={offset:3,itemSize:3};n.attributes.uv={offset:6,itemSize:2};s(n,t,e);return n}function u(t,e,r){var i=n.getObject(t);if(!i)return null;if(i.type===2){return o(e,r)}else if(i.type===4){return null}else if(i.type===5){return null}return null}function h(){var i=n.getObjectCount();var s=false;var o=0;for(var h=0;h<i;++h){o+=a(h)}var f=o?new ArrayBuffer(o):null;var p=0;var l=f?[f]:[];var y=c(e.package,e.packageType,2,f);y.workerId=e.workerId;for(var h=0;h<i;++h){var v=u(h,f,p);if(v){p+=v.byteLength||0;y.vbo[h]=v}else{if(!s){r.raiseError(2,"Bad Data",{url:e.url});s=true}t.sendMessage(e,y)}}t.sendMessage(y,l)}}function v(e){var r=e.worker;var n=e.context;var a=n.stream;return u();function s(){var t={facetCount:a.readUint32(),package:a.readString(),idx:a.readVarint()};a.readBox();return t}function o(t){var e=n.getObject(t);if(!e)return null;if(e.type===6){return s()}return null}function u(){var a=false;var s=n.getObjectCount();var u=c(e.package,e.packageType,6);for(var h=0;h<s;++h){var f=o(h);if(f){u.vbo[h]=f}else{if(!a){r.raiseError(2,"Bad Data",{url:e.url});a=true}t.sendMessage(e,u)}}if(e.data){e.data.meshes=u.vbo;i(e)}else{t.sendMessage(u)}u=null}}function d(e){var r=e.worker;var n=e.context;var a=n.stream;return u();function s(t,r){r.materialIdx[t]=a.readVarint();var n=a.readVarint();l(r.mesh2frag,n,t);r.frag2mesh[t]=n;var i=t*6;for(var s=0;s<6;++s){r.bbox[i+s]=a.readFloat32()}var o=a.readTransform4();if(e.data.world){var u=e.data.world.transform;o.premultiply(u)}r.transform.set(o.elements,t*16);n=a.readInt32();r.frag2idx[t]=n;l(r.idx2frag,n,t);return true}function o(t,e){var r=n.getObject(t);if(!r)return false;if(r.type===3){return s(t,e)}return false}function u(){var a=false;var s=n.getObjectCount();var u={materialIdx:null,mesh2frag:t.createDictionary(),frag2mesh:null,facets:null,frag2idx:null,idx2frag:null,bbox:null,transform:null,length:s};var h=s*102;var f=h?new ArrayBuffer(h):null;var p=f?[f]:[];if(h){u.materialIdx=new Int32Array(f,0,s);u.frag2idx=new Int32Array(f,s*4,s);u.bbox=new Float32Array(f,s*8,s*6);u.transform=new Float32Array(f,s*32,s*16);u.frag2mesh=new Int32Array(f,s*96,s);u.facets=new Uint16Array(f,s*100,s);u.idx2frag=t.createDictionary()}var l=c(e.package,e.packageType,3,f);for(var y=0;y<s;++y){var v=o(y,u);if(!v){if(!a){r.raiseError(2,"Bad Data",{url:e.url});a=true}t.sendMessage(e,l)}}if(e.data){if(e.data.fragments){var v=e.data.fragments;v["materialIdx"]=u.materialIdx;v["bbox"]=u.bbox;v["frag2idx"]=u.frag2idx;v["idx2frag"]=u.idx2frag;v["transform"]=u.transform;v["length"]=u.length;v["mesh2frag"]=u.mesh2frag;v["frag2mesh"]=u.frag2mesh}else{e.data["fragments"]=u}u=null;if(f)e.data["transferList"].push(f);i(e)}else{l.vbo=u;t.sendMessage(l,p)}l=null;f=null;p=null}}function m(e){var r=e.context;var n=e.worker;var a=r.stream;return l();function s(e){e.world.up=a.readVector3f();e.world.boundingBox=a.readBox();e.world.transform=t.createMatrix4(true);a.readArray(e.world.transform.elements,16);return true}function o(t){t.camera.isPerspective=a.readBoolean();t.camera.aspect=a.readFloat32();t.camera.fov=a.readFloat32();t.camera.orthoScale=a.readFloat32();t.camera.position=a.readVector3f();t.camera.target=a.readVector3f();t.camera.up=a.readVector3f();return true}function u(t){var e=a.readVarint();for(var r=0;r<e;++r){t.packages.push(a.readString())}return true}function h(t){var e=a.readVarint();for(var r=0;r<e;++r){t.uuids.push(a.readUniqueId())}return true}function f(t,e){var n=r.getObject(t);if(!n)return false;if(n.type===10){return s(e)}else if(n.type===0){return o(e)}else if(n.type===9){return u(e)}else if(n.type===8){return h(e)}return false}function l(){var a=false;var s=r.getObjectCount();var o=c(e.package,e.packageType,10);var u=p();o.vbo=u;for(var h=0;h<s;++h){var l=f(h,u);if(!l){if(!a){n.raiseError(2,"Bad Data",{url:e.url});a=true}t.sendMessage(e,o)}}if(e.data){e.data["world"]=u.world;e.data["camera"]=u.camera;e.data["packages"]=u.packages;e.data["uuids"]=u.uuids;i(e)}else{t.sendMessage(o)}o=null;u=null}}function x(e){var r=e.worker;var n=e.context;var a=n.stream;return h();function s(t,e,r,n,i,s){if(i===void 0){i=false}if(s===void 0){s=false}if((r&n)===n){if(t[e]===undefined)t[e]={};t[e]["path"]=a.readString();var o=new Float32Array(9);var u=a.readBoolean();if(u){o.set([1,0,0,0,1,0,0,0,1])}else{a.readArray(o,9)}t[e]["transform"]=o;if(i)t[e]["item1"]=a.readFloat32();if(s)t[e]["item2"]=a.readFloat32()}}function o(t,e){var r={name:"",color:0,shininess:0,opacity:0,transparency:false};r.name=a.readString();r.color=a.readInt32();r.shininess=a.readInt32();r.opacity=a.readFloat32();r.transparency=r.opacity<1;r.reflectivity=a.readFloat32();var n=a.readUint8();if((n&4)==4){r.emissive=a.readInt32()}if((n&8)==8){r.specular=a.readInt32()}var i=a.readUint16();s(r,"map",i,1);s(r,"bumpMap",i,2,true);s(r,"alphaMap",i,4);s(r,"normalMap",i,8,true,true);s(r,"aoMap",i,16,true);s(r,"displacementMap",i,32,true,true);s(r,"emissiveMap",i,64,true);s(r,"envMap",i,128);s(r,"lightMap",i,256,true);s(r,"specularMap",i,512);return r}function u(t,e,r){var i=n.getObject(t);if(!i)return null;if(i.type===7){return o(e,r)}return null}function h(){var a=false;var s=n.getObjectCount();var o=9;var h=null;var f=h?[h]:[];var p=c(e.package,e.packageType,7,h);var l=0;for(var y=0;y<s;++y){var v=u(y,h,l);if(v){l+=o;p.vbo[y]=v}else{if(!a){r.raiseError(2,"Bad Data",{url:e.url});a=true}t.sendMessage(e,p)}}if(e.data){e.data["materials"]=p.vbo;if(h)e.data.transferList.push(h);i(e)}else{t.sendMessage(p,f)}h=null;f=null;p=null}}function g(e){var r=e.worker;var n=e.context;var a=n.stream;return f();function s(t){var e=a.readVarint();for(var r=0;r<e;r++){t[r]=a.readString()}}function o(t,e,r){var n=0;var i=0;var s=0;for(var o=0;o<r;o++){t[o]=n;e[n++]=a.readVarint();e[n++]=a.readVarint();i=a.readVarint();e[n++]=i;for(var u=0;u<i;u++){e[n++]=a.readVarint();s=a.readVarint();e[n++]=s;for(var h=0;h<s;h++){e[n++]=a.readVarint();e[n++]=a.readVarint()}}}}function u(t){s(t.names);s(t.types);s(t.category);s(t.keys);s(t.values);var e=a.readVarint();var r=a.getPosition();a.seek(8,2);var n=a.readUint32();a.seek(r,0);var i=n-r;t.indices=new Uint32Array(e);t.pairs=new Uint32Array(i);o(t.indices,t.pairs,e);return t}function h(t,e){var r=n.getObject(t);if(!r)return null;if(r.type===11){return u(e)}return null}
function f(){var r=false;var a=n.getObjectCount();var s=[];var o=[];var u=[];var f=[];var p=[];var l={types:f,names:p,category:s,keys:o,values:u,indices:null,pairs:null};var y=c(e.package,e.packageType,11);for(var v=0;v<a;v++){var d=h(v,l);if(d){y.vbo[v]=d}}if(e.data){e.data["attributes"]=y.vbo;var m=y.vbo;for(var v=0;v<m.length;v++){e.data["transferList"].push(m[v].indices.buffer,m[v].pairs.buffer)}i(e)}else{t.sendMessage(y)}}}})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(t){}t.upload=e})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(t){}t.search=e})(Nevm||(Nevm={}));var Nevm;(function(t){"use strict";function e(e){if(!e.hasOwnProperty("action"))return;t.route(e)}self.addEventListener("message",function(t){var r=t.data;r.worker=self;e(r)},false)})(Nevm||(Nevm={}));